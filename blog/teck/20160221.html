<!DOCTYPE html>
<html>
<head lang="ja">
<META http-equiv="Content-Type" content="text/html; charset=utf8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0">
<meta name="description" content="TOPにも書いてあるように、わりとゲスな理由で始めて見ました。今後ちょっとずつコンテンツを増やしつつ、コンテンツを増やすということは開発をするということでして・・・"/>
<meta name="keywords" content="ご挨拶,エンジニア,ゆとり"/>
<meta name="createdate" content="2016-02-21"/>
<meta property="og:locale" content="ja_JP" />
<meta property="og:type" content="article" />
<meta property="og:title" content="ブログの成り立ち（1）｜ぬるぶろ" />
<meta property="og:description" content="TOPにも書いてあるように、わりとゲスな理由で始めて見ました。今後ちょっとずつコンテンツを増やしつつ、コンテンツを増やすということは開発をするということでして・・・" />
<meta property="og:site_name" content="ぬるぶろ" />
<meta property="article:author" content="https://github.com/nullblog/" />
<meta property="fb:app_id" content="668279799978855" />
<title>ブログの成り立ち（1）｜ぬるぶろ</title>
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/common.css">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/vue/1.0.16/vue.min.js"></script>
</head>
<body>
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-NWH746"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NWH746');</script>
<!-- End Google Tag Manager -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ja_JP/sdk.js#xfbml=1&version=v2.5&appId=668279799978855";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script>
<script>
(function() {
  var cx = '016288219579585099976:kl3aw8lrnoo';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//cse.google.com/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
</script>
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">ぬるぶろ</a>
    </div>
    <div class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li class="active"><a href="/">ホーム</a></li>
        <li><a href="/blog/">ブログ</a></li>
      </ul>
    </div>
  </div>
</div>
<div class="container-fluid">
  <div class="row">
    <div class="col-xs-12 text-center">
      <div class="row">
        <h1 class='col-md-6 col-md-offset-3'>ぬるぶろ</h1>
        <small class='col-md-3 text-right'>更新日:2016-02-21</small>
      </div>
    </div>
    <div id="col-left" class="col-md-3 col-left text-center">
      <div class="row">
        <div class="col-xs-12">
          <gcse:search></gcse:search>
        </div>
        <div class="col-xs-12">
          <div class="fb-like" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div>
          <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
          <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        </div>
      </div>
    </div>
    <div id='col-center' class="col-md-6 col-center">
<link href="http://alexgorbatchev.com/pub/sh/current/styles/shCoreDefault.css" rel="stylesheet" type="text/css">
<link href="http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css" rel="stylesheet" type="text/css">
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js" type="text/javascript"></script>
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushPhp.js" type="text/javascript"></script>
<script type="text/javascript">
SyntaxHighlighter.all();
SyntaxHighlighter.defaults['toolbar'] = false;
</script>
<style>
.syntaxhighlighter {
  border:solid 1px #EEE !important;
  overflow-y: hidden !important;
}
.syntaxhighlighter table {
  margin-top: 1em !important;
  margin-bottom: 1em !important;
}
.syntaxhighlighter .line.alt2 {
  background-color: #F8F8F8 !important;
}
</style>
<div class="row">
  <div class="col-xs-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title text-center">ブログの成り立ち（1）</h3>
      </div>
      <div class="panel-body">
      <p><strong>githubでブログ作ろうとしたらめっちゃ大変やんけ・・・</strong></p>
      <p>以前WEB広告のお仕事をしていたので</p>
      <p>自分でブログ書いて広告貼ってチャリンチャリン儲けようと思ったわけですが</p>
      <p>サーバー代って結構厄介なわけです。</p>
      <p>場合によっては負荷高騰とか考えなくちゃいけないし</p>
      <p>既存のブログサービスに乗っかろうとすると</p>
      <p>自分で広告貼るには有料会員にならないといけなかったり。。。</p>
      <p>しかも自分で広告運用しようとしている人は絶対に<strong>優良会員</strong>ではないんですよねｗ</p>
      <p>cookie情報抜いたり色んな行動情報集めていたり</p>
      <p>そりゃあ広告業者は嫌われますよ</p>
      <p><small>広告貼ったらoptoutのリンクは付けなくちゃとは思っています。</small></p>
      <br>
      <p>そんで！</p>
      <p>計測タグとか広告タグとか色々突っ込まなくちゃいけないので</p>
      <p>「とりあえずheaderとfooterは共通化したい！」という</p>
      <p>ざっくりとした希望の元に動き出しました。</p>
      <p>今回は第一弾なので中でも一番核になる部分のblog-builderについてお話いたします。</p>
      <p>正直大した事はしていないので<a href="https://github.com/nullblog/nullblog.github.io/blob/master/work/make_blog.php" target="_blank">実装をさっくり見てもらった方が</a>早い人は早いです。</p>
      <br>
      <br>
      <p>最初はnode.jsでgulp使ってejs辺りで～とか思っていたんですけど</p>
      <p>やっぱり自分はphperなんだなと思い知らされました。</p>
      <p>故にphpで書いています。</p>
      <p>workスペースを区切ってそこにbuild用のscriptを置いています。</p>
      <p>テンプレート関連は<a href='https://github.com/nullblog/nullblog.github.io/tree/master/work/src' target="_blank">src</a>に</p>
      <p>その中には共通テンプレートの<a href='https://github.com/nullblog/nullblog.github.io/tree/master/work/src/common' target='_blank'>common</a>と</p>
      <p>記事詳細を突っ込んでおく<a href='https://github.com/nullblog/nullblog.github.io/tree/master/work/src/detail' target='_blank'>detail</a>があります。</p>
      <p>基本的にはdetailの中身を再帰的に探してきてhtmlとして書き出されたものを取得してファイル書き出しをする</p>
      <p>の繰り返しです。</p>
      <br>
      <br>
      <p>ファイルの書き出しをする時に面倒な事を考えたくなかったので</p>
      <p>普通にhttpリクエストで読み込む時と同じような書き方をしています。</p>
      <p>記事詳細の書き方をいちいち覚えていられないので<a href='https://github.com/nullblog/nullblog.github.io/blob/master/work/src/detail/_template.php' target="_blank">記事詳細用のテンプレート</a>なんてのも用意しています。</p>
      <p>meta情報をサクッと書いて、記事の詳細をhtmlで組んでいくと良い感じになるのがわかる</p>
      <p>とても良いテンプレートです。</p>
      <p>headファイルとfootファイルは繰り返し読み込む事になるので</p>
      <p>通常仕事では<a href='http://php.net/manual/ja/function.require-once.php' target='_blank'>「require_once」</a>とか使うんですけど</p>
      <p>今回は<a href='http://php.net/manual/ja/function.include.php' target='_blank'>「include」</a>を使っています。</p>
      <p>テンプレートの中にphpのメソッドは書いてはいけない状態になった事は肝に銘じておきます。</p>
      <br>
      <br>
      <p>実際の処理ですが、先に書いたように階層下ってfile拾って実行して書き出すだけなので</p>
      <p>特に珍しいことはしていません。</p>
      <p>唯一珍しい事と言えば、phpとして実行した結果を受け取らなくてはいけなかったので</p>
      <p><a href='http://php.net/manual/ja/function.ob-start.php'>「ob-start」</a>を使っていることぐらいでしょうか。</p>
<pre class='brush: php'>/**
 * fileの実行結果を取得する
 * @param string $fileName
 * @return string
 */
function getFile($fileName) {
	$contents = "";
	ob_start(); // 標準出力を抑制
	include($fileName); // ファイルの実行
	$contents = ob_get_contents(); // 実行結果を受け取る
	ob_end_clean(); // 標準出力の抑制解除
	return $contents;
}</pre>
      <p>こんな感じで使っていますね。</p>
      <p>あとは再帰処理の時に変数の使いまわしが簡単なようにclassに突っ込んだぐらいで</p>
      <p>特段珍しいことはしていません。</p>
      <br><br>
      <p>書き出しが愚痴っぽくなってしまったのでとりあえず次回に期待を・・・</p>
      </div>
    </div>
  </div>
</div>
    </div>
    <div id="col-right" class="col-md-3 col-right">
      <div class="panel-heading">
        <h3 class="panel-title text-center">ブログ一覧</h3>
      </div>
      <div class="panel-body">
        <label for="blog-search">絞り込みform</label>
        <select id="blog-search" class="form-control">
          <option v-for="list in blogLists" value="{{ list.path }}">{{ list.genre }}</option>
        </select>
      </div>

      <table id="blog-histry" class="table table-striped">
        <tr v-for="list in blogLists">
          <td><a href="{{ list.href }}"><strong>{{ list.title }}</strong></a></td>
          <td><a href="{{ list.href }}"><small>{{ list.blogtype }}</small></a></td>
          <td><a href="{{ list.href }}"><small>{{ list.date }}</small></a></td>
        </tr>
      </table>
    </div>
  </div>
</div>
<script src="/js/makelist.js"></script>
</body>
</html>
